# Greenatom Test Task

## Описание

Веб-сервис, разработанный с использованием фреймворка FastAPI для хостинга изображений. Поддерживает загрузку от 1 до 15
файлов в формате
`jpeg` c последующим их сохранением и занесением информации в базу данных.

## Реализованные обработчики

### 1. PUT /frame/

На вход подаются изображения в формате jpeg. Количество передаваемых файлов может быть от 1 до 15.

Функция сохраняет переданные файлы в папку `/data/<дата в формате YYYYMMDD>/` с именами `<GUID>.jpg` и фиксирует в базе
данных в таблице inbox со структурой:

`<код запроса> | <имя сохраненного файла> | <дата / время регистрации>`

В случае успеха обрабочик возвращает HTTP 201 Created и уникальный код запроса для взаимодействия с загруженными файлами
в будущем.

    HTTP 201 Created
      {
        "request_code": <код запроса>
      }

В случае если было отправлено больше 15 файлов возвращается ошибка HTTP 403 Forbidden.

    HTTP 403 Forbidden
      {
        "detail": "No more than 15 images can be sent"
      }

В случае если были отправлены файлы не соответсвующие формату `image/jpeg` будет возвращена ошибка HTTP 403 Forbidden.

    HTTP 403 Forbidden
      {
        "detail": "All images should have jpeg format"
      }

### 2. GET /frame/<код запроса>

На вход подается код запроса.

В случае успеха возвращается список соответствующих коду запроса изображений в формате JSON, включая дату и время
регистрации и имена файлов.

    HTTP 200 OK
    [
      {
        "name": "054f5fd8-6f36-4975-bf4c-fbf7b4de0ba7",
        "created_at": "2021-11-03T10:45:33.137124+00:00"
      },
      {
        "name": "2863b612-7849-4d52-8bfd-cb4567113ede",
        "created_at": "2021-11-03T10:45:33.164169+00:00"
      }
    ]

В случае отправки несуществующего кода запроса возвращается ошибка HTTP 404 Not Found.

    HTTP 404 Not Found
    {
      "detail": "Images not found"
    }

### 3. DELETE /frame/<код запроса>

На вход подается код запроса. Функция удаляет данные по запросу из базы данных и соответствующие файлы изображений и
папки `/data/`.

В случае успеха возвращается HTTP 200 OK и код запроса удаленных файлов.

    HTTP 200 OK
    {
      "deleted": "57e151b5-94fa-4b6c-b1fb-b7ceae8ba8db"
    }

В случае отправки несуществующего кода запроса возвращается ошибка HTTP 404 Not Found:

    HTTP 404 Not Found
    {
      "detail": "Images not found"
    }

## Запуск проекта

1. Заполните файл .env_dev, указав адрес базы данных `INBOX_DATABASE_URL`
2. Запустите базу данных при помощи Docker:

   `docker-compose -f docker-compose.yml up`
3. Запустите приложение:

   `python main.py`

## Запуск тестов

1. Заполните файл .env_dev, указав адрес тестовой базы данных `TEST_DATABASE_URL` и активировав тестовый
   режим `TEST_MODE = True`

2. Запустите базу данных при помощи Docker:

   `docker-compose -f docker-compose.yml up`

3. Запустите тесты:

   `python -m pytest tests`

